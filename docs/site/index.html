<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>soundcast-user-guide</title>
  

  <link rel="shortcut icon" href="./img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="./css/theme.css" type="text/css" />
  <link rel="stylesheet" href="./css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="./css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "None";
  </script>
  
  <script src="./js/jquery-2.1.1.min.js"></script>
  <script src="./js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="./js/highlight.pack.js"></script>
  <script src="./js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="." class="icon icon-home"> soundcast-user-guide</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href=".">Home</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#soundcast-users-guide">Soundcast Users' Guide</a></li>
                
                    <li><a class="toctree-l4" href="#hardware-recommendations">Hardware Recommendations</a></li>
                
                    <li><a class="toctree-l4" href="#software-recommendations">Software Recommendations</a></li>
                
                    <li><a class="toctree-l4" href="#initial-setup">Initial Setup</a></li>
                
                    <li><a class="toctree-l4" href="#run-configuration">Run Configuration</a></li>
                
                    <li><a class="toctree-l4" href="#inputs">Inputs</a></li>
                
                    <li><a class="toctree-l4" href="#running-the-model">Running the Model</a></li>
                
                    <li><a class="toctree-l4" href="#log-files">Log Files</a></li>
                
                    <li><a class="toctree-l4" href="#model-structure">Model Structure</a></li>
                
                    <li><a class="toctree-l4" href="#results-and-outputs">Results and Outputs</a></li>
                
                    <li><a class="toctree-l4" href="#resources">Resources</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="file-structure/">FileStructure</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href=".">soundcast-user-guide</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".">Docs</a> &raquo;</li>
    
      
    
    <li>Home</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="soundcast-users-guide">Soundcast Users' Guide</h1>
<p>The Soundcast model package includes all estimated and calibrated demand models and scripts to assign demand onto road and transit networks. Soundcast's demand models were developed as part of the DaySim activity model framework by consultants <a href="http://www.rsginc.com/">RSG</a>. As shown in the figure below, the demand models process land use, demographics, and network inputs to produce trip tables by user class and time of day. These trips (i.e., 'demand') are then assigned to travel networks using <a href="http://www.inrosoftware.com/">INRO's Emme software</a>. If network assignment hasn't yet reached equilibrium, cost and time skims are sent back to the DaySim demand models to produce trip tables that incorporate network conditions from the latest model iteration. Upon convergence (specified as a configurable parameter) the model estimation will conclude and produce summary reports. </p>
<p><img alt="Soundcast flow diagram" src="http://i61.tinypic.com/2u5xjwn.jpg" /></p>
<h2 id="hardware-recommendations">Hardware Recommendations</h2>
<pre><code>- 100 GB disk space for each model run
- 32 GB RAM recommended
- Minimum of 12 processors
</code></pre>
<p>(Soundcast can be run on machines with less memory and fewer processors, but run time will be extended.)</p>
<h2 id="software-recommendations">Software Recommendations</h2>
<pre><code>- INRO Emme 4 License, with capability for processing 4000-zone matrices
- Only tested on 64-bit Windows 7 OS
- Anaconda Python Package (Python 2.7 with helper libraries included)
</code></pre>
<h2 id="initial-setup">Initial Setup</h2>
<p>All Soundcast scripts are stored within a public <a href="https://github.com/psrc/soundcast">GitHub repository</a>. If you're familiar with Git technology, you can <a href="http://git-scm.com/docs/git-clone">clone</a> the repository on your modeling machine. </p>
<p>Alternatively, you can download all the code as a ZIP file. </p>
<p><img alt="Download GitHub ZIP" src="http://oi60.tinypic.com/dxmo2u.jpg" /></p>
<h3 id="python-packages-and-paths">Python Packages and Paths</h3>
<p>It's recommended to <a href="https://repo.continuum.io/archive">install the Anaconda Python package</a> to run Soundcast. This package should include all necessary libraries to run the model. When installing, make sure the installer adds the Anaconda install to the system path (or add it yourself after installing). It's important that this install is the one referenced whenever the "python" program is invoked from a command. Many machines might include another Python install; it's okay to leave other versions installed, but you'll want to update the path variable to point only to the Anaconda version. In order to avoid conflicts with Emme's Python install, <em>download package version 2.2.0.</em> <a href="./2.2.0 https://repo.continuum.io/arcive/Anaconda-2.2.0-Windows-x86_64.exe">Click here to directly download Anaconda 2.2.0 for 64-bit Windows</a>. Additionally, you may want to install Anaconda for current users only (not for all users). Sometimes installing Python for all users will conflict with administrative rights, so it's best to install and use it as a local user. </p>
<p>After installing Anaconda, you must change Emme's settings to use the Anaconda installation by default. Otherwise, scripts that interact with Emme will use another install without the necessary libraries. To change the Python version used by Emme, select Tools (from the main taskbar) and click 'Application Options'. Under the Modeller tab is a field "Python path", which by default probably looks like:</p>
<pre><code>%&lt;$EmmePath&gt;%/Python27
</code></pre>
<p><img alt="Emme Python version settings" src="http://oi57.tinypic.com/2466ecp.jpg" /></p>
<p>Replace this path with the full path to the Anaconda Python executable (python.exe). Depending on where Anaconda was installed, it may be something like:</p>
<pre><code>C:\Anaconda
</code></pre>
<h3 id="troubleshooting-python-install">Troubleshooting Python Install</h3>
<p>Emme's Python libraries can conflict with the Anaconda install used to run Python. As of Emme release 4.2.3, there are two known conflicts with the Anaconda libraries. Two libraries "ply" and "pyqt" from Anaconda clash with Emme. INRO's solution is to remove these two libraries from the Anaconda install and rely on the Emme libraries. This works for Anaconda 2.2.0 and prior releases, but does not work for the latest versions. For now, the recommended approach is to use Anaconda 2.2.0 and remove ply and pyqt libraries. This can be done from the command prompt with "conda uninstall ply" and "condat uninstall pyqt". When these libraries are removed from Anaconda, Emme will look to its local install of these packages, which should have no conflicts.</p>
<h3 id="install-additional-python-libraries">Install additional Python libraries</h3>
<p>Although the Anaconda Python package include many libraries, there are some specialized libraries required for Soundcast that are not included. Fortunately, these can easily be added from the command prompt. The required additional libraries are:</p>
<pre><code>- pysal (used to read geodatabase files from ArcGIS)
- pandas_highcharts (for visualization of results in iPython notebooks)
</code></pre>
<p>These can be added either by typing "pip install [library name]" or "conda install [library name]". If the model run crashes because of a missing library, it should be easy to quickly add the library and restart the model from the point of failure.</p>
<h3 id="install-7-zip">Install 7-zip</h3>
<p>Soundcast inputs are very large and are stored as compressed files to save space. Scripts rely on the 7-zip tool to open and expand these files, and the program <em>must be added to the system path</em>. Before running Soundcast, ensure that 7-zip is installed. If not, it can be <a href="http://www.7-zip.org/">freely obtained here</a>. Once installed, copy the location of the 7-zip.exe and add it to the system's path environment variable. To do this, open the Environment Variables window under Control Panel and edit the "path" system variable (the second scroll window from the top).</p>
<h2 id="run-configuration">Run Configuration</h2>
<p>Once Python paths and versions are defined and installed, inputs must be provided and configuration settings specified. Input locations and run settings are controlled centrally from the file <strong>"input_configuration.py".</strong> This is a Python script, but it simply holds variable definitions which are passed into other scripts when the model runs. The input configuration contains paths to input directories, scenario names and analysis years, and also controls number of iterations and convergence criteria. Additionally, it allows finer control over specific model components. For instance, all demand, skimming, and assignment iterations can be turned off, and only specific summarization scripts run, or the model can be set to stop after importing certain input files. Scroll to the end of the Variable value field, add paste the directory to the 7zip exe (ensuring it is separated with a semicolon from previous fields).</p>
<p>Scenarios and input paths are defined as follows by default. Users must point to the location of these inputs and ensure the inputs follow a format as defined later in this guide. </p>
<pre><code>- base_year = '2010'  # This should always be 2010 unless the base year changes
- scenario_name = '2040'
- daysim_code = 'R:/soundcast/daysim' 
- master_project = 'LoadTripTables'
- base_inputs = 'R:/soundcast/inputs/' + scenario_name
- network_buffer_inputs = 'R:/soundcast/inputs/parcel_buffering_network/parcel_buff_network_inputs.7z'
- network_buffer_code = 'R:/SoundCast/util/parcel_buffering/'
</code></pre>
<p>The following variables act as control parameters for the model. They are mostly self-explanatory by their variable name. </p>
<pre><code>- run_update_parking = False
- run_convert_hhinc_2000_2010 = False
- run_parcel_buffering = True
- run_copy_daysim_code = True
- run_setup_emme_project_folders = True
- run_setup_emme_bank_folders = True
- run_copy_large_inputs = True
- run_import_networks = True
- run_skims_and_paths_seed_trips = True
- should_build_shadow_price =True
- run_skims_and_paths = True
- run_truck_model = True
- run_supplemental_trips = True
- run_daysim = True
- run_parcel_buffer_summary = True
- run_network_summary = True
- run_soundcast_summary = True
- run_travel_time_summary = True
- run_create_daily_bank = True
</code></pre>
<p>For a basic run, these variables can be left in their default state as stored in the GitHub repository. This applies for all other variables in the input_configuration file, aside from the input directories listed above, which must be defined appropriately by the user.</p>
<p>Other important parameters that the user may which to adjust are the number of defined model iterations and population sample settings.</p>
<pre><code>- pop_sample = [10, 5, 1, 1, 1, 1]   
- shadow_work = [1, 1, 1, 1]
- shadow_con = 10 #%RMSE for shadow pricing to consider being converged
- STOP_THRESHOLD = 0.025
- parallel_instances = 12   # Number of simultaneous parallel processes. Must be a factor of 12.
- max_iter = 50             # Assignment Convergence Criteria
- best_relative_gap = 0.01  # Assignment Convergence Criteria
- relative_gap = .0001
- normalized_gap = 0.01
</code></pre>
<p>The population sample (pop_sample) is a list of population sample proportions for each iteration to be produced by the DaySim demand models. In the example above, the 10 implies 1/10th of the population will be modeled (to save time for the first pass), and 5 implies 1/5th, whereas 1 represents a full population run. The length of the list represents the number of times the model might be run, if it doesn't first converge.</p>
<p>The "shadow_work" variable represents the number of iterations for which shadow pricing will be run. This is an important part of the demand models, but consumes significant run time; the parameter should only be changed with good reason. </p>
<p>The remaining variables in input_configuration are not intended to be changed by the user. Many are definitions that should not change, except with major model revisions. They're stored in this file for consistency, rather than scattering variable definitions across a number of scripts.</p>
<h2 id="inputs">Inputs</h2>
<p>Soundcast inputs will be provided as a zipped folder to users. However, at this time, inputs will only be available to users with authorized access to use Washington State's highly employment disaggregate data. PSRC is still working through solutions to provide model access to all users without access to this sensitive data. </p>
<p>For users that are able to receive the input, the folder should be unzipped and stored on a local drive. The path must be specified in "input_configuration.py" and folder structure should not be changed. Soundcast copies all inputs into the local Soundcast directory to keep paths consistent, and allows for a central storage point of different model inputs. Input folders will typically be named to represent the land use and network year, e.g., 2010 or 2040. </p>
<p>The inputs directory should be structured as follows:</p>
<pre><code>- 4k    # inputs for truck model, based on estimates from trip-based 4k model
    - auto.h5
    - transit.h5
- etc
    - daysim_outputs_seed_trips.h5    # seed trips to use on first iteration of DaySim
    - survey.h5    # 2006 household travel survey for DaySim estimation validation summaries
- landuse
    - buffered_parcels.dat
    - daily_parking_costs.csv
    - hh_and_persons.h5
    - hourly_parking_costs.csv
    - parcels_military.csv    # Military employment data
    - parcels_urbansim.txt    # Primary land-use data at the parcel level
    - schema.ini
    - tazdata.in
- networks
    - am_roadway.in
    - am_transit.in
    - am_turns.in
    ... (roadway, transit, and turns network files for 5 times of day: am, md, pm, ev, ni)
    - vehicles.txt    # list of transit vehicles and characteristics
    - modes.txt    # list of modes and their characteristics
    - fixes
        - ferries
            - am_roadway.in
            ... (roadway ferry flags for 5 times of day: am, md, pm, ev, ni)
    - rdly
        - am_rdly.txt
        ... (rdly.txt for 5 times of day: am, md, pm, ev, ni)
    - various shapefiles for showing smooth network shapes, rather than blocky network topology. Edges 0-4 correspond to 5 times of day, in order: am, md, pm, ev, ni
- supplemental
    - generation
    - distribution
    - trips
- tolls
    - am_roadway_tolls.in
    - bridge_ferry_flags.in
    - ev_roadway_tolls.in
    - ferry_vehicle_fares.in
    - md_roadway_tolls.in
    - ni_roadway_tolls.in
    - pm_roadway_tolls.in
- trucks
    - agshar.in
    - const.in
    - districts19_ga.ens
    - equipshar.in
    - heavy_trucks_reeb_ee.in
    - heavy_trucks_reeb_ei.in
    - heavy_trucks_reeb_ie.in
    - input_skims.txt
    - matrix_balancing_spec.txt
    - matric_calc_spec.txt
    - minshar.in
    - prodshar.in
    - special_gen_heavy_trucks.in
    - special_gen_light_trucks.in
    - special_gen_medium_trucks.in
    - tazdata.in
    - tcushar.in
    - truck_gen_calc_dict.txt
    - truck_matrices_dict.txt
    - truck_operating_costs.in
    - whlsshar.in
</code></pre>
<h2 id="running-the-model">Running the Model</h2>
<p>Once the inputs have been properly structured and configuration defined, Soundcast can be started with a single command-line prompt. Open a command prompt and navigate to the location the soundcast directory. In the main directory, type:</p>
<pre><code>- python run_soundcast.py
</code></pre>
<p>This will call the run_soundcast script in Python, which is the master script file to start the model. Depending on the modules specified to run in input_configuration, Soundcast will be spawn its different processes. For a new run, this includes copying inputs into the local Soundcast directory, creating new directories to store outputs, initializing Emme projects, and finally starting an iteration of DaySim demand models and assignment. The model should run until convergence, or until maximum numbers of global iterations are attained, and (if specified) produce summary files and end. </p>
<h2 id="log-files">Log Files</h2>
<p>The Soundcast run can be monitored in the command prompt, since many functions include print statements, but since it takes many hours to complete a run, all important status outputs are stored in log files in the main Soundcast directory. The two primary log files are:</p>
<pre><code>- soundcast_log.txt
- skims_log.txt
</code></pre>
<p>The soundcast log contains high-level informatino about when different modules of the run began and were completed. Here's an example from the first 2 iterations of a soundcast log:</p>
<pre><code>06/02/2015 11:25:39 AM ------------------------NEW RUN STARTING---------------------------------------
06/02/2015 11:26:11 AM  build_seed_skims starting
06/02/2015 07:39:14 PM build_seed_skims took 8:13:03.651000
06/02/2015 07:39:15 PM We're on iteration 0


06/02/2015 07:39:15 PM starting run 2015-06-02 19:39:15.084000
06/02/2015 07:39:15 PM  modify_config starting
06/02/2015 07:39:15 PM modify_config took 0:00:00
06/02/2015 07:39:15 PM  daysim_assignment starting
06/02/2015 07:39:15 PM Start of 0 iteration of Daysim
06/02/2015 08:28:47 PM End of 0 iteration of Daysim
06/02/2015 08:47:46 PM Start of 0 iteration of Skims and Paths
06/03/2015 09:03:20 AM End of 0 iteration of Skims and Paths
06/03/2015 09:03:20 AM daysim_assignment took 13:24:05.685000
06/03/2015 09:03:20 AM  check_convergence starting
06/03/2015 09:03:20 AM check_convergence took 0:00:00
06/03/2015 09:03:20 AM We're on iteration 1


06/03/2015 09:03:20 AM starting run 2015-06-03 09:03:20.784000
06/03/2015 09:03:20 AM  modify_config starting
06/03/2015 09:03:20 AM modify_config took 0:00:00
06/03/2015 09:03:20 AM  daysim_assignment starting
06/03/2015 09:03:20 AM Start of 1 iteration of Daysim
06/03/2015 10:33:40 AM End of 1 iteration of Daysim
06/03/2015 10:40:47 AM Start of 1 iteration of Skims and Paths
06/03/2015 02:09:30 PM End of 1 iteration of Skims and Paths
06/03/2015 02:09:30 PM daysim_assignment took 5:06:09.604000
06/03/2015 02:09:30 PM  check_convergence starting
06/03/2015 02:09:30 PM check_convergence took 0:00:00.015000
06/03/2015 02:09:30 PM We're on iteration 2
</code></pre>
<p>The skims log provides details on when each assignment and skimming script began, how long it took to complete, and the resulting relative gap, for each user class and time of day.</p>
<h2 id="model-structure">Model Structure</h2>
<p>Soundcast is designed to run its processes in a specific order. Understanding this flow is critical to performing partial runs (e.g., traffic assignment or demand only) that will save processing time. Being able to recover from a crash mid-way through a model run requires knowledge of how the model's scripts are designed. The basic process is as follows.</p>
<h3 id="run_soundcastpy">run_soundcast.py</h3>
<p>Soundcast's primary controller script is run_soundcast.py. Most of the major model functions are controlled here, along with input_configuration.py, which controls which processes are run, and certain input values. The run_soundcast script is rather readable, with many processes self-documented by relevant function or variable names. As with all Python scripts in Soundcast, the main function of the scripts are contained in the main() function. This is the part of the script that is first executed. In run_soundcast, subprocesses are called in a specific order. Subprocesses are controlled by binary variables that are defined in input_configuration. If these control variables are defined as True in input_configuration, Soundcast will execute that subprocess. For instance, if the variable "run_copy_daysim_code" is defined as True in the configuration, then Soundcast will run the function to move all Daysim inputs into the local directory. Many times, if a model run is being run for another iteration, or has been stopped during a crash, these processes will not need to be repeated, so they are frequently turned off (set to False). The order of subprocesses exectued by run_soundcast are as follows:</p>
<pre><code>- parcel buffering (land use preparation for demand estimation)
- parcel buffering summary (a CSV for error checking)
- copy Daysim code
- setup emmebank and project folders (for each time of day used in assignment)
- copy large inputs to local directory
- update household income to base year (2010) values
- import networks
- run all skims and paths (using seed trips for 0th iteration)
- demand modeling with Daysim
- assign truck and supplemental (external, special generator) trips
- run skims and paths using Daysim demand results
- repeat global demand and assignment for fixed number of iterations
</code></pre>
<p>The number of global iterations is defined in input_configuration.py, as the length of the pop_sample array. Each value in this list represents an iteration of demand+skimming/assignment. The number corresponds to the population size being sampled on that run. Samples are used to reduce run time, and the sample size should gradually increase with each iteration. The number is actually the denominator of the population size. For instance pop_sample = [10,5,2] indicates that 3 global iterations will be performed. The first will use a population sample size of 1/10th the actual population, the next a sample of 1/5, and finally a sample of 1/2. </p>
<h2 id="results-and-outputs">Results and Outputs</h2>
<p>As the model runs, results are stored in the 'outputs' directory of the local soundcast folder. Emme-related outputs are stored in 'projects' and 'banks' folders. Users can view results by time of day by opening up the corresponding project and bank in Emme. These files contain all time and cost skims by vehicle class and time of day. They are also available in a compressed format (hdf5) and, somewhat confusingly, created in the 'inputs' folder after an assignment iteration. They're stored in inputs because they're used as inputs to DaySim demand modeling, though they will represent the last assignment and skimming pass. These output files are named by their time period (e.g., 5to6.h5) and can be viewed interactively with Python or the <a href="https://sites.google.com/site/openmodeldata/file-cabinet/omx-viewer">OMX Viewer</a> GUI.</p>
<p>Results of DaySim demand are stored in hdf5 format as well, in the 'daysim_outputs.h5' file stored in the 'outputs' folder. These outputs include details for all persons, households, trips, and tours taken in the region, for a typical travel day. These include all the details about demographics and trip characteristics like mode, purpose, time, origin and destination, and many others. </p>
<p>Soundcast includes Python scripts to summarize model results and create output spreadsheets. The primary summaries are available in the following sheets:</p>
<pre><code>- network_summary.xlsx
- Topsheet.xlsx
</code></pre>
<p>Other summaries are included for detailed DaySim and network summaries as needed. Users may also create their own summaries by directly evaluating the h5 output files.</p>
<p><a href="file-structure/">File Information and Directory Structure</a></p>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="http://www.psrc.org/data/models/abmodel/">Activity-Based Modeling at PSRC</a></li>
<li><a href="">Soundcast Technical Design Document</a></li>
<li><a href="https://github.com/psrc/soundcast">Soundcast GitHub Repo</a></li>
<li><a href="http://onlinepubs.trb.org/onlinepubs/shrp2/SHRP2_C46.pdf">Acitivty-Based Model Primer</a></li>
<li><a href="http://www.psrc.org/about/contact/staff-roster/">PSRC Staff</a></li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="file-structure/" class="btn btn-neutral float-right" title="FileStructure"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
      
        <span style="margin-left: 15px"><a href="file-structure/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>

<!--
MkDocs version : 0.14.0
Build Date UTC : 2015-12-09 21:36:51.473000
-->
